// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2024 FriendlyElec Computer Tech. Co., Ltd.
 * (http://www.friendlyarm.com)
 *
 * Copyright (c) 2020 Rockchip Electronics Co., Ltd.
 */

/dts-v1/;

#include "rk3566.dtsi"
#include "rk3568-nanopi5-common.dtsi"

/ {
	model = "FriendlyElec NanoPi R3G";
	compatible = "friendlyelec,nanopi-r3g", "rockchip,rk3566";

	aliases {
		ethernet0 = &gmac1;
	};

	/delete-node/ gpio-keys;

	gpio_leds: gpio-leds {
		compatible = "gpio-leds";

		sys_led: led-0 {
			gpios = <&gpio0 RK_PB7 GPIO_ACTIVE_HIGH>;
			label = "sys_led";
			linux,default-trigger = "heartbeat";
			pinctrl-names = "default";
			pinctrl-0 = <&sys_led_pin>;
		};

		usr_led1: led-1 {
			gpios = <&gpio3 RK_PC1 GPIO_ACTIVE_HIGH>;
			label = "led1";
			pinctrl-names = "default";
			pinctrl-0 = <&usr_led1_pin>;
		};

		usr_led2: led-2 {
			gpios = <&gpio3 RK_PC2 GPIO_ACTIVE_HIGH>;
			label = "led2";
			pinctrl-names = "default";
			pinctrl-0 = <&usr_led2_pin>;
		};

		usr_led3: led-3 {
			gpios = <&gpio3 RK_PC3 GPIO_ACTIVE_HIGH>;
			label = "led3";
			pinctrl-names = "default";
			pinctrl-0 = <&usr_led3_pin>;
		};
	};

	pwm_vibrator: pwm-vibrator {
		compatible = "pwm-vibrator";
		pwm-names = "enable";
		pwms = <&pwm5 0 1000000000 0>;
	};
};

&combphy1_usq {
	status = "okay";
};

&combphy2_psq {
	status = "okay";
};

&dfi {
	status = "okay";
};

&dmc {
	center-supply = <&vdd_logic>;
	status = "okay";
};

&gmac1 {
	phy-mode = "rgmii";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio4 RK_PC2 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	/* Reset time is 15ms, 50ms for rtl8211f */
	snps,reset-delays-us = <0 15000 50000>;

	assigned-clocks = <&cru SCLK_GMAC1_RX_TX>, <&cru SCLK_GMAC1>;
	assigned-clock-parents = <&cru SCLK_GMAC1_RGMII_SPEED>, <&cru CLK_MAC1_2TOP>;
	assigned-clock-rates = <0>, <125000000>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac1m0_miim
		     &gmac1m0_tx_bus2_level3
		     &gmac1m0_rx_bus2
		     &gmac1m0_rgmii_clk_level2
		     &gmac1m0_rgmii_bus_level3>;

	tx_delay = <0x3c>;
	rx_delay = <0x2f>;

	phy-handle = <&rgmii_phy1>;
	status = "okay";
};

&mach {
	hwrev = <7>;
	model = "NanoPi R3G";
	machine = "NANOPI-R3";
};

&mdio1 {
	rgmii_phy1: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
		interrupt-parent = <&gpio4>;
		interrupts = <RK_PC3 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&gmac_int>;
		realtek,ledsel = <0xae00>;
	};
};

&i2c1 {
	status = "okay";

	eeprom@53 {
		compatible = "microchip,24c02", "atmel,24c02";
		reg = <0x53>;
		#address-cells = <2>;
		#size-cells = <0>;
		pagesize = <16>;
		size = <256>;

		eui_48: eui-48@fa {
			reg = <0xfa 0x06>;
		};
	};
};

&i2c2 {
	status = "disabled";
};

&i2c5 {
	status = "disabled";
};

&pcie2x1 {
	status = "disabled";
};

&pinctrl {
	gmac {
		gmac_int: gmac-int {
			rockchip,pins =
				<4 RK_PC3 RK_FUNC_GPIO &pcfg_pull_up>;
		};
	};

	gpio-leds {
		sys_led_pin: sys-led-pin {
			rockchip,pins =
				<0 RK_PB7 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		usr_led1_pin: usr-led1-pin {
			rockchip,pins =
				<3 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		usr_led2_pin: usr-led2-pin {
			rockchip,pins =
				<3 RK_PC2 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		usr_led3_pin: usr-led3-pin {
			rockchip,pins =
				<3 RK_PC3 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
};

&pmu_io_domains {
	status = "okay";
	pmuio2-supply = <&vcc3v3_pmu>;
	vccio2-supply = <&vcc_1v8>;
	vccio3-supply = <&vccio_sd>;
	vccio4-supply = <&vcc_3v3>;
	vccio5-supply = <&vcc_1v8>;
	vccio6-supply = <&vcc_3v3>;
	vccio7-supply = <&vcc_3v3>;
};

&pwm0 {
	status = "disabled";
	/* connected with sys_led */
};

&pwm4 {
	status = "disabled";
};

&pwm5 {
	status = "okay";
};

&sata1 {
	status = "disabled";
};

&sata2 {
	status = "disabled";
};

&sfc {
	status = "disabled";
};

&u2phy0_host {
	phy-supply = <&vcc5v0_host>;
	status = "okay";
};

&u2phy0_otg {
	/delete-property/ phy-supply;
	status = "okay";
};

/delete-node/ &vcc5v0_otg;

&u2phy1_host {
	status = "disabled";
};

&u2phy1_otg {
	status = "disabled";
};

&usb2phy0 {
	status = "okay";
};

&usb2phy1 {
	status = "disabled";
};

&usb_host0_ehci {
	status = "okay";
};

&usb_host0_ohci {
	status = "okay";
};

&usb_host1_ehci {
	status = "disabled";
};

&usb_host1_ohci {
	status = "disabled";
};

&usbdrd_dwc3 {
	dr_mode = "otg";
	extcon = <&usb2phy0>;
	status = "okay";
};

&usbdrd30 {
	status = "okay";
};

&usbhost_dwc3 {
	status = "disabled";
};

&usbhost30 {
	status = "disabled";
};
